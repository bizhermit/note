# GitBizFlow

## 概要

アジャイルや即リリース、バージョンは常時最新のみといったようなモダンな開発
——ができない現場でも崩壊させないためのブランチ戦略。

## フローイメージ

![img](git-biz-flow.drawio.svg)

## 各ブランチの役割

※ 作業用以外のブランチでコード修正およびコミットは行わない。

### main

開発のヘッドブランチ。
プロダクトとは別だが、基本的には常時リリース可能な状態を維持。

### feature(s)

追加機能を実装する作業用ブランチ。

mainブランチ（mainブランチへのマージタイミング調整中のfeaturesブランチの変更をベースに作業したい場合は該当するfeaturesブランチ）から作成し、実装が終わったらdevelopブランチにPRを作成・マージする。
developブランチで確認がとれたら、当ブランチをmainブランチにPRを作成・マージする。
つまり当ブランチはdevelopとmainの二つのブランチにPRを作成することになる。
mainブランチにマージ後に削除する。ごみを残すな。

developブランチへのPRではコードレビュー、mainブランチへのPRではリリースタイミングの調整を主な目的とする。

### develop

実装した追加機能を確認するブランチ。

ユニットテストおよび結合テストを行う。リリースタイミングを調整しているtestブランチとは差別化。

テストする機能を選別したい場合は、featuresブランチのマージのタイミングを調整する。
当ブランチをマージする先は存在しない。

mainブランチで代用も可能だが、動作未確認コードが含まれたブランチからfeaturesを作成したくない／できない場合や、リリース（結合）タイミングを調整したい状況は十分に考えられる。

ユニットテストはある程度自動化しておきたい。

### test(s)

QAやシステムテスト、外部結合テストをを行うブランチ。

mainブランチの追加機能がある程度塊になったら、mainブランチから作成／マージする。

mainブランチでも代用は可能だが、mainブランチは更新頻度が高くなりやすい。そのためmainブランチへのマージをトリガーにすると、テスト環境へのデプロイタイミングが調整しずらかったり、GitHub Actions等の起動回数が増えて課金額が高くなってしまうことが考えられる。
また、複数の観点（業務シナリオ、本番相当データ、負荷確認等々）で確認が必要になった際、分けられるようにしておいた方が都合が良いことが多い。

使用しなくなったら削除する。

### bugfix(s)

結合テストで発見されたバグ等の指摘事項に対応する作業用ブランチ。

testブランチから作成し、実装が対応が終わったらtestブランチにマージする。
testブランチにて動作確認が完了した後、他のtest全て、mainおよびdevelopブランチを最新化するため、それぞれのブランチに対してマージを行う。マージ後、当ブランチは削除する。

マージ先が多くなりやすいため実装品質が低いと地獄。でもdevelopブランチでほとんど潰せているはずで、bugfixブランチが乱立する場合はdevelopブランチにおけるテストや、各PRレビューのレベルが低すぎるんじゃなかろうか。

### release(s)

リリースブランチ。
プロダクトに該当するもので、マージされる度にタグおよびリリースノートを作成する。

### hotfix(s)

リリースブランチに対する緊急作業用ブランチ。

作業環境でのみ動作確認をしてリリースするため、本当に緊急の場合のみ使用する。
本腰入れて対応が必要な場合は、hotfixで暫定対処（特定機能を無効化等）した後、maintenancesおよびpatchブランチにて本対処を行う。

マージ先はrelease、test、main、developブランチ。マージ後、当ブランチは削除する。

### maintenance(s)

リリースブランチに対する保守用ブランチ。

課題ごとにreleaseブランチのクローンを作成しテストを行う。
実際の修正作業はpatchブランチにて行う。
修正確認が終わり次第、release、test、main、developブランチにマージ、当ブランチは削除する。

### patche(s)

メンテナンス作業用ブランチ。

maitenancesブランチから作成し、修正が完了したらmentenancesブランチにPRを作成する。
mentenancesブランチにマージされた後、当ブランチは削除する。

## フロー運用

1. featureで機能追加してdevelopへ投入
2. developで確認、不備があればfeatureへ差し戻し
3. featureをmainへ投入
4. testをmainで最新化して確認（この間featureからmainへのマージは原則禁止）
5. testで不備があればbuffixで修正
6. mainをreleaseへ投入
7. releaseに対する修正はmaintenance

## 評価

### メリット

- だいたいのケースには対応できる
- 機能追加のリリースタイミングの調整が可能
- 複数バージョンの並列保守に対応

### デメリット

- ブランチの種類が多い
- プロダクト規模、メンバーの品質によっては冗長
- fix系のブランチのマージ先が多い（CI駆使すればなんとか……）
- 承認プロセスが緩め（testで確認していなくてもreleaseに出ていけてしまう）
- 運用管理者の腕次第で普通に崩壊しそう